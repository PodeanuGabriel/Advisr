@extends('layout.main')

@include('modals/add-app')

@section('content')


<div class="container-fluid">
    <div class="row">

        <div class="col-md-2">

            <div class="sidebar dashboard-sidebar">
                <a class="btn btn-primary" data-toggle="modal" data-target="#addAppModal" role="button">ADD APP</a>
            </div>

            <div class="sidebar dashboard-sidebar">
                <ul id="appList" class="nav nav-sidebar">
                    <?php
                    foreach($apps as $app)
                    {
                    ?>

                    <li><a id="<?php echo $app->appid; ?>" onclick="getAppDetails(this.id);"> <?php echo str_replace('\'', '', $app->name); ?> </a></li>

                    <?php
                    }
                    ?>
                </ul>
            </div>

            <div style="clear:both"></div>

        </div>

        <div class="col-md-10">

            <h1 class="page-header">Dashboard</h1>
            <div class="row placeholders">
                <div id="appDetails" class="col-sm-9 placeholder"></div>
            </div>

            <div style="clear:both"></div>

        </div>

    </div>
</div>

<script>

    window.addEventListener(
        "load",
        function()
        {
            $("#appList li:first-child a:first-child").trigger("click");
        },
        false
    );

    function renderForm(objFormData)
    {
        var elForm = document.createElement("form");
        elForm.setAttribute("class", "form-horizontal");
        elForm.setAttribute("method", objFormData.method);
        elForm.setAttribute("action", objFormData.action);

        for(var objInput in objFormData.fields)
        {
            var elContainer = document.createElement("div");
            elContainer.setAttribute("class", "form-group");

            var elFormInputLabel = document.createElement("label");
            elFormInputLabel.setAttribute("class", "col-sm-3 control-label");
            elFormInputLabel.innerHTML = objFormData.fields[objInput].label;

            var elFormInputContainer = document.createElement("div");
            elFormInputContainer.setAttribute("class", "col-sm-6");

            var elFormInput = document.createElement("input");
            elFormInput.setAttribute("type", objFormData.fields[objInput].type);
            elFormInput.setAttribute("name", objFormData.fields[objInput].name);
            elFormInput.setAttribute("value", objFormData.fields[objInput].value);
            elFormInput.setAttribute("class", "form-control");
            elFormInput.setAttribute("required", "required");
            elFormInput.setAttribute("aria-required", "true");

            elFormInputContainer.appendChild(elFormInput);
            elContainer.appendChild(elFormInputLabel);
            elContainer.appendChild(elFormInputContainer);
            elForm.appendChild(elContainer);
        }

        var elSubmitButtonContainer = document.createElement("div");
        elSubmitButtonContainer.setAttribute("class", "col-sm-9 modal-footer");

        var elSubmitButton = document.createElement("input");
        elSubmitButton.setAttribute("type", "submit");
        elSubmitButton.setAttribute("value", "Save");
        elSubmitButton.setAttribute("class", "btn btn-success");

        elSubmitButtonContainer.appendChild(elSubmitButton);
        elForm.appendChild(elSubmitButtonContainer);

        document.getElementById(objFormData.parent_id).appendChild(elForm);
    }

    function clearForm(mxParentID)
    {
        var elAppDetails = document.getElementById(mxParentID);
        while (elAppDetails.firstChild)
        {
            elAppDetails.removeChild(elAppDetails.firstChild);
        }

    }

    function getAppDetails(appID)
    {
        // Remove the active class from all <li> elements
        $("#appList > li").each(
            function()
            {
                $(this).removeClass();
            }
        );

        // Add the active class to the first <li> element
        document.getElementById(appID).parentNode.setAttribute("class", "active");


        $.get(
            "{{ URL::to('app-get') }}/"+appID,
            function(mxResult)
            {
                var objResult = JSON.parse(mxResult);
                if(objResult.length)
                {
                    // Remove previous rendered form
                    clearForm("appDetails");
                
                    var objFormData = {};

                    objFormData.parent_id = "appDetails";
                    objFormData.method = "POST";
                    objFormData.action = "{{ URL::to('app-edit') }}/"+appID;

                    objFormData.fields = [];
                    objFormData.fields.push(
                        {
                            "label": "App name",
                            "type": "text",
                            "name": "name",
                            "value": objResult[0]["name"].replace(/['"]+/g, '')
                        }
                    );
                    objFormData.fields.push(
                        {
                            "label": "App data URL",
                            "type": "url",
                            "name": "data_url",
                            "value": objResult[0]["data_url"].replace(/['"]+/g, '')
                        }
                    );
                    objFormData.fields.push(
                        {
                            "label": "Rating type",
                            "type": "text",
                            "name": "rating_type",
                            "value": objResult[0]["rating_type"].replace(/['"]+/g, '')
                        }
                    );

                    renderForm(objFormData);
                }
            }
        );
    }

</script>

@stop