<?php

use evseevnn\Cassandra;

class UserController extends BaseController {

	public function signup()
	{

        $database = App::make('database');

        if(Request::isMethod('post'))
        {
            $errors = array();


            if(Input::has("name"))
                $name = Input::get('name');
            else
                $errors[] = 'Please enter your name!';

            if(Input::has("email"))
                $email = Input::get("email");
            else
                $errors[] = 'Please enter your email!';

            if(Input::has('password'))
                $password = Hash::make(Input::get('password'));
            else
                $errors[] = 'Please enter a password!';

            if(empty($errors)){

                $insertQuery = "INSERT INTO users (id, name, email, password, registered_date ) VALUES ( '".Uuid::generate()."' , '".$name."'
                                ,'".$email."', '".$password."', '".date('Y-m-d H:i:s', time())."' )";
                try{
                    $user = $database->query($insertQuery);
                } catch(Exception $e){
                    return View::make('index')->with('error', 'Signup failed. Please try again later.');
                }

            } else {
                return Redirect::to('signup')->with('errors', $errors);
            }


        }
        else if(Request::isMethod('get'))
        {
            return View::make('signup');
        }
	}

    public function login(){
        $nodes = [
            '127.0.0.1'
        ];

        // Connect to database.
        $database = new Cassandra\Database($nodes, 'advisr');
        $database->connect();

    }


}
